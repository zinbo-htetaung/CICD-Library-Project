<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Library Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #F9F7F7;
            /* Lightest background */
            color: #112D4E;
            /* Deep Blue for text */
        }

        header {
            background-color: #DBE2EF;
            /* Light Blue for header background */
            color: #112D4E;
            /* Deep Blue for text */
        }

        header h1 {
            color: #3F72AF;
            /* Medium Blue for main heading */
        }

        h2 {
            color: #3F72AF;
            /* Medium Blue */
            font-weight: bold;
        }

        header p {
            color: #112D4E;
            /* Deep Blue for subtext */
        }

        /* Card Styling */
        .card {
            background-color: #F9F7F7;
            /* Lightest Color */
            border: 1px solid #DBE2EF;
            /* Light Blue border */
        }

        .card-title {
            color: #3F72AF;
            /* Medium Blue */
        }

        .card-text {
            color: #112D4E;
            /* Deep Blue */
        }

        .btn-primary {
            background-color: #3F72AF;
            /* Medium Blue */
            border-color: #3F72AF;
        }

        .btn-primary:hover {
            background-color: #112D4E;
            /* Deep Blue */
            border-color: #112D4E;
        }

        /* Accordion Styling */
        .accordion-button {
            background-color: #DBE2EF;
            /* Light Blue */
            color: #112D4E;
            /* Deep Blue for text */
        }

        .accordion-button:not(.collapsed) {
            background-color: #3F72AF;
            /* Medium Blue */
            color: #F9F7F7;
            /* Lightest Color for active state */
        }

        .accordion-body {
            background-color: #F9F7F7;
            /* Lightest Color */
            color: #112D4E;
            /* Deep Blue */
        }

        /* Form Styling */
        input,
        textarea {
            border: 1px solid #DBE2EF;
            /* Light Blue */
            background-color: #F9F7F7;
            /* Lightest Color */
            color: #112D4E;
            /* Deep Blue */
        }

        input::placeholder,
        textarea::placeholder {
            color: #DBE2EF;
            /* Light Blue placeholder */
        }

        button[type="submit"] {
            background-color: #3F72AF;
            /* Medium Blue */
            color: #F9F7F7;
            /* Lightest Color */
            border: none;
        }

        button[type="submit"]:hover {
            background-color: #112D4E;
            /* Deep Blue */
        }

        /* Chatbot container style */
        #chatbot-container {
            margin: 50px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 450px;
            background-color: #DBE2EF;
            /* Light Blue */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 1000;
            opacity: 0;
            transform: translateY(100px);
            animation: slideIn 0.5s ease-out forwards;
        }

        /* Slide-in animation for chatbot container */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(100px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Bot message fade-in and bounce animation */
        @keyframes botMessageBounce {
            0% {
                opacity: 0;
                transform: translateX(-30px);
            }

            50% {
                opacity: 1;
                transform: translateX(10px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Bot messages */
        .bot-message {
            background-color: #F9F7F7;
            /* Lightest Color */
            color: #112D4E;
            /* Deep Blue */
            align-self: flex-start;
            animation: botMessageBounce 0.5s ease-out;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 10px;
            max-width: 80%;
        }

        /* User messages */
        .user-message {
            background-color: #3F72AF;
            /* Medium Blue */
            color: #F9F7F7;
            /* Lightest Color */
            align-self: flex-end;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 10px;
            max-width: 80%;
            width: auto;
            word-wrap: break-word;
            display: inline-block;
        }

        /* Floating Button Style (Chatbot Icon) */
        #chatbot-toggle-btn {
            position: fixed;
            bottom: 50px;
            right: 50px;
            background-color: transparent;
            /* Deep Blue */
            border: none;
            padding: 0;
            font-size: 40px;
            cursor: pointer;
            z-index: 1000;
            animation: bounceIcon 1s ease-in-out infinite;
        }

        /* Icon animation for the chatbot */
        @keyframes bounceIcon {
            0% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }

            50% {
                transform: translateY(0);
            }

            70% {
                transform: translateY(-5px);
            }

            100% {
                transform: translateY(0);
            }
        }

        /* Chatbot Icon image */
        #chatbot-toggle-btn img {
            width: 75px;
            height: 75px;
            object-fit: cover;
            border-radius: 50%;
        }

        /* Notification badge */
        #notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            width: 15px;
            height: 15px;
            background-color: #3F72AF;
            /* Medium Blue */
            border-radius: 50%;
            color: #F9F7F7;
            /* Lightest Color */
            font-size: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        #chatbot-header {
            background-color: #3F72AF;
            /* Medium Blue */
            color: #F9F7F7;
            /* Lightest Color */
            padding: 10px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            text-align: center;
            font-size: 18px;
            position: relative;
        }

        #chatbot-header .close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: transparent;
            border: none;
            color: #F9F7F7;
            /* Lightest Color */
            font-size: 18px;
            cursor: pointer;
        }

        /* Typing animation */
        .typing {
            display: inline-block;
            position: relative;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .typing:after {
            content: ".";
            position: absolute;
            animation: typingEffect 1.5s infinite steps(1, end);
        }

        @keyframes typingEffect {
            0% {
                content: ".";
            }

            33% {
                content: "..";
            }

            66% {
                content: "...";
            }

            100% {
                content: ".";
            }
        }

        /* Chatbot messages container */
        #chatbot-messages {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            padding: 10px;
            overflow-y: auto;
            flex-grow: 1;
            height: calc(100% - 140px);
            overflow-wrap: break-word;
        }

        .bot-response-options {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 10px;
        }

        .bot-response-options button {
            background-color: #3F72AF;
            /* Medium Blue */
            color: #F9F7F7;
            /* Lightest Color */
            border: none;
            padding: 5px 10px;
            margin-top: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .bot-response-options button:hover {
            background-color: #112D4E;
            /* Deep Blue */
        }

        #chatbot-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid #DBE2EF;
            /* Light Blue */
        }

        #chatbot-input {
            flex-grow: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #DBE2EF;
            /* Light Blue */
        }

        #chatbot-send-btn {
            background-color: #3F72AF;
            /* Medium Blue */
            color: #F9F7F7;
            /* Lightest Color */
            border: none;
            padding: 8px;
            margin-left: 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        #chatbot-send-btn:hover {
            background-color: #112D4E;
            /* Deep Blue */
        }
    </style>
</head>

<body>
    <div id="navbar-container"></div>

    <!-- Introduction Sentence Header -->
    <header class="text-center py-5 bg-light">
        <h1>Welcome to Our Library</h1>
        <p>Your gateway to a world of knowledge and adventure. Explore, request, and borrow books from our vast
            collection!</p>
    </header>

    <!-- About Us and Additional Cards Section -->
    <section class="container my-5">
        <div class="row">
            <!-- About Us Section -->
            <div class="col-md-4 mt-4">
                <div class="card shadow-lg border-light rounded">
                    <div class="card-body text-center">
                        <h2 class="card-title mb-4">About Us</h2>
                        <p class="text-muted mb-4">A community library that opens doors to knowledge, creativity, and
                            growth, for all ages and interests.</p>

                        <h4 class="mb-3">Why We're Special</h4>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-book-half me-3 fs-2 text-primary"></i>
                                    <div>
                                        <p class="text-muted mb-0">Dive into our endless digital libraryâ€”free e-books,
                                            audiobooks, and more.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-person-check me-3 fs-2 text-primary"></i>
                                    <div>
                                        <p class="text-muted mb-0">No membership feesâ€”reading is for everyone,
                                            everywhere.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-recycle me-3 fs-2 text-primary"></i>
                                    <div>
                                        <p class="text-muted mb-0">We support sustainability with digital content and
                                            green community initiatives.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Library Services Section -->
            <div class="col-md-8">
                <div class="row">
                    <!-- View Books Card -->
                    <div class="col-md-4">
                        <div class="card">
                            <img src="../../images/exploreBooks.jpg" class="card-img-top" alt="View Books">
                            <div class="card-body">
                                <h5 class="card-title">Explore Our Books</h5>
                                <p class="card-text">Browse our vast collection of books across various genres. Find
                                    your next great read!</p>
                                <a href="books.html" class="btn btn-primary mb-2">Browse Now</a>
                            </div>
                        </div>
                    </div>

                    <!-- Request Books Card -->
                    <div class="col-md-4">
                        <div class="card">
                            <img src="../../images/requestBook.jpg" class="card-img-top" alt="Request Book">
                            <div class="card-body">
                                <h5 class="card-title">Request a Book</h5>
                                <p class="card-text">Looking for a book that isn't available? Let us know, and we'll
                                    request it for you.</p>
                                <a href="book-requests.html" class="btn btn-primary mb-2">Request Book</a>
                            </div>
                        </div>
                    </div>

                    <!-- Return Books Card -->
                    <div class="col-md-4">
                        <div class="card">
                            <img src="../../images/returnBook.jpg" class="card-img-top" alt="Return Book">
                            <div class="card-body">
                                <h5 class="card-title">Return a Book</h5>
                                <p class="card-text">Have books to return? Drop them off at your convenience and keep
                                    the cycle going.</p>
                                <a href="return-book.html" class="btn btn-primary mb-2">Return Now</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Frequently Asked Questions Section -->
    <section class="container my-5">
        <h2 class="text-center">Frequently Asked Questions</h2>
        <div class="accordion" id="faqAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="faqOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        How can I borrow books?
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="faqOne"
                    data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        You can borrow books by signing up for a membership and visiting the library or by requesting
                        books online through our platform.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="faqTwo">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Do you charge fees for borrowing books?
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="faqTwo"
                    data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Borrowing books is free for all registered members. However, there may be late fees for overdue
                        books.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="faqThree">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        How can I become a member?
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="faqThree"
                    data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Becoming a member is easy! You can sign up through our website or by visiting the library with a
                        valid ID.
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="container my-5 email-us-section">
        <h2 class="text-center">Email Us</h2>
        <p class="text-center">Have questions or feedback? Send us an email, and we'll get back to you as soon as
            possible!</p>
        <form id="contact-form">
            <div class="mb-3">
                <input type="text" class="form-control" id="name" name="name" placeholder="Your Name" required />
            </div>
            <div class="mb-3">
                <input type="email" class="form-control" id="email" name="email" placeholder="Your Email" required />
            </div>
            <div class="mb-3">
                <textarea class="form-control" id="message" name="message" rows="5" placeholder="Your Message"
                    required></textarea>
            </div>
            <div class="col-md-3">
                <div class="g-recaptcha" data-sitekey="6LcLaXYUAAAAAOYUvT0g3IpuM2HLnmg47B_3Wugd"></div>
            </div>
            <div id="form-message" style="min-height: 25px; margin-top: 10px; color: red; font-size: 14px;">&nbsp;</div>
            <button type="submit" class="btn btn-primary" style="margin-top: 3px;">Send Message</button>
        </form>
    </section>
    <!-- Chatbot Container -->
    <div id="chatbot-container">
        <div id="chatbot-header">
            Chat with Us
            <button class="close-btn" onclick="closeChatbot()">Ã—</button> <!-- Close Button -->
        </div>
        <div id="chatbot-messages"></div>
        <div id="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Ask me anything..." />
            <button id="chatbot-send-btn">Send</button>
        </div>
        <div id="chatbot-options"></div> <!-- Container for the response options -->
    </div>

    <!-- Chatbot Toggle Button with Notification Badge -->
    <button id="chatbot-toggle-btn" onclick="sendGreetingMessage()">
        <img src="../../images/chatbot.jpg" alt="Chatbot Icon" />
        <div id="notification-badge">1</div> <!-- Red notification badge -->
    </button>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>

    <script>
        let searchInProgress = false; // Flag to track search process
        let bookName = ''; // Store book name for search

        // Check if the greeting has been shown before
        let hasGreeted = false;
        // Function to send a greeting message when the chatbot icon is clicked
        function sendGreetingMessage() {
            // Only show the greeting if it's the first time opening the chatbot
            if (!hasGreeted) {
                let botResponse = "Hello! How can I assist you today?"; // Greeting message
                displayMessage(botResponse, 'bot'); // Show the bot's greeting message
                hasGreeted = true // Mark as greeted in localStorage
            }
            displayResponseOptions(); // Show the response options below the greeting
        }

        // Function to close the chatbot
        function closeChatbot() {
            let chatbotContainer = document.getElementById('chatbot-container');
            chatbotContainer.style.display = 'none'; // Hide the chatbot container
        }

        // Simple chatbot logic for sending messages
        document.getElementById('chatbot-send-btn').addEventListener('click', function () {
            let userInput = document.getElementById('chatbot-input').value.trim();
            if (userInput) {
                // Display user message
                displayMessage(userInput, 'user');

                if (searchInProgress) {
                    // If search is in progress, perform the book search
                    bookName = userInput; // Save the book name entered
                    searchBooks(bookName); // Trigger search
                } else {
                    // Generate bot response
                    let botResponse = generateBotResponse(userInput);

                    // Display bot response after a short delay
                    setTimeout(function () {
                        displayMessage(botResponse, 'bot');
                        displayResponseOptions(); // Always show options below the conversation
                    }, 500);
                }
            }
            document.getElementById('chatbot-input').value = ''; // Clear input field
        });

        // Function to display messages in the chatbox
        // Function to display messages in the chatbox
        function displayMessage(message, sender) {
            let messageContainer = document.createElement('div');
            messageContainer.classList.add('message');
            messageContainer.classList.add(sender === 'user' ? 'user-message' : 'bot-message');

            // Use innerHTML to allow HTML content (like <a> tag) to be rendered correctly
            messageContainer.innerHTML = message;

            document.getElementById('chatbot-messages').appendChild(messageContainer);
            document.getElementById('chatbot-messages').scrollTop = document.getElementById('chatbot-messages').scrollHeight;
        }

        // Function to generate bot responses
        // function generateBotResponse(userInput) {
        //     userInput = userInput.toLowerCase();

        //     if (userInput.includes('hours') || userInput.includes('open')) {
        //         return "We are open from 9 AM to 6 PM every day!";
        //     } else if (userInput.includes('books') || userInput.includes('collection')) {
        //         return 'We have a large collection of books available for borrowing! <a href="displayAllBooks.html" target="_blank">Explore more ^^</a>';
        //     } else if (userInput.includes('membership')) {
        //         return "You can sign up for a membership on our website or by visiting the library.";
        //     } else if (userInput.includes('agent') || userInput.includes('help') || userInput.includes('contact') || userInput.includes('agree')) {
        //         return "I will connect you to a live agent shortly.";
        //     } else if (userInput.includes('search') && !searchInProgress) {
        //         searchInProgress = true; // Prevent repeating the search request
        //         return "Please enter the book name you want to search for.";
        //     } else {
        //         return "I'm not sure how to respond to that. Press \"Agree\" to contact a live agent.";
        //     }
        // }

        function generateBotResponse(userInput) {
            let doc = nlp(userInput.toLowerCase());

            // Match user intent for greetings
            if (doc.has('hello') || doc.has('hi') || doc.has('hey')) {
                return "Hello! How can I assist you today? ðŸ˜Š";
            } else if (doc.has('how are you') || doc.has('how\'s it going')) {
                return "I'm just a bot, but I'm here to help you! How can I assist you?";
            }
            // Match intent for library hours
            else if (doc.has('hours') || doc.has('open') || doc.has('close')) {
                return "We are open from 9 AM to 6 PM every day!";
            }
            // Match intent for book collection
            else if (doc.has('books') || doc.has('collection')) {
                return 'We have a large collection of books! <a href="displayAllBooks.html" target="_blank">Explore here.</a>';
            }
            // Match intent for membership
            else if (doc.has('membership') || doc.has('register')) {
                return "Sign up for membership on our website or visit the library with an ID.";
            }
            // Match intent for live agent or help
            else if (doc.has('contact') || doc.has('agent') || doc.has('help')) {
                return "I will connect you to a live agent shortly.";
            }
            // Match intent for book search
            else if (doc.has('search') && !searchInProgress) {
                searchInProgress = true;
                return "Please type the name of the book you're searching for.";
            }
            // Fallback response
            else {
                return "I'm not sure how to respond to that. Try asking about our opening hours, books, or membership. If you want to chat with a live agent, press \'Agent'. ^^ ";
            }
        }
        // Function to search for books and display the results
        async function searchBooks(bookName) {
            try {
                const response = await fetch(`/api/books/name/${bookName}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                const container = document.getElementById('chatbot-messages');
                if (response.status === 200) {
                    const data = await response.json();
                    let i = 1;
                    if (data.books.length > 0) {
                        data.books.forEach(book => {
                            let bookMessage = `Found book: (${i})  ${book.book_name} by ${book.author}. <a href="displaySingleBook.html?id=${book.id}" target="_blank">Click here to view details ^^</a>`;
                            displayMessage(bookMessage, 'bot');
                            i++;
                        });
                    } else {
                        displayMessage("Sorry, no books were found matching your search. Please press \"Search Book\" again to search more. ^^", 'bot');
                    }
                } else {
                    displayMessage("Sorry, no books were found matching your search. Please press \"Search Book\" again to search more. ^^", 'bot');
                }
            } catch (error) {
                console.error('Error searching for books:', error);
                displayMessage("I'm sorry, I couldn't search for books at the moment. Please press \"Search Book\" again to search more. ^^", 'bot');
            }

            searchInProgress = false; // Reset searchInProgress after search completes
        }

        // Function to display response options (buttons)
        function displayResponseOptions() {
            let optionsContainer = document.createElement('div');
            optionsContainer.classList.add('bot-response-options');

            const options = [
                { label: 'Library Hours', value: 'hours' },
                { label: 'Book Collection', value: 'books' },
                { label: 'Membership', value: 'membership' },
                { label: 'Contact a Live Agent', value: 'agent' },
                { label: 'Search Book', value: 'search' }
            ];

            options.forEach(option => {
                let button = document.createElement('button');
                button.textContent = option.label;
                button.onclick = function () {
                    displayMessage(option.label, 'user');
                    let botResponse = generateBotResponse(option.value);
                    setTimeout(function () {
                        displayMessage(botResponse, 'bot');
                    }, 500);
                };
                optionsContainer.appendChild(button);
            });

            document.getElementById('chatbot-options').innerHTML = ''; // Clear previous options
            document.getElementById('chatbot-options').appendChild(optionsContainer);
        }

        // Toggle the visibility of the chatbot
        document.getElementById('chatbot-toggle-btn').addEventListener('click', function () {
            let chatbotContainer = document.getElementById('chatbot-container');
            if (chatbotContainer.style.display === "none" || chatbotContainer.style.display === "") {
                chatbotContainer.style.display = "flex";
                setTimeout(function () {
                    chatbotContainer.style.opacity = "1";
                }, 10); // Short delay to trigger opacity transition
                sendGreetingMessage(); // Show greeting if it's the first time
            } else {
                chatbotContainer.style.opacity = "0";
                setTimeout(function () {
                    chatbotContainer.style.display = "none";
                }, 300); // Delay to ensure opacity transition completes
            }
        });
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <script src="../js/home.js" type="text/javascript"></script>
    <div id="footer-container"></div>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://unpkg.com/compromise"></script>
</body>

</html>